// 世界模拟器.js
document.getElementById('w').addEventListener('change',function(){const e=document.getElementById('cwc');"custom"===this.value?e.classList.remove('h'):e.classList.add('h')});document.getElementById('gs').addEventListener('change',function(){const e=document.getElementById('cg');"custom"===this.value?e.value="":this.value&&(e.value=this.value)});const e=document.getElementById('cb'),t=document.getElementById('bts');e.addEventListener('focus',function(){t.style.display='block'}),e.addEventListener('blur',function(){setTimeout(()=>{t.style.display='none'},200)}),document.querySelectorAll('.bo').forEach(e=>{e.addEventListener('mousedown',function(t){t.preventDefault(),e.value=this.getAttribute('data-value')})});const i=document.getElementById('rc'),n=document.getElementById('arb');let r=0,o=3;n.addEventListener('click',function(){if(r>=o)return;const e=document.createElement('div');e.className='ri',e.innerHTML='<input type="text" class="f1" placeholder="请输入世界规则..."><button class="b bsm bd drb">-</button>',i.appendChild(e),r++,r>=o&&(n.disabled=!0)}),i.addEventListener('click',function(e){e.target.classList.contains('drb')&&(e.target.closest('.ri').remove(),r--,n.disabled=!1)});const l=document.getElementById('tdb'),c=document.getElementById('cd'),s=document.getElementById('sdc');l.addEventListener('click',function(){c.classList.contains('h')?(c.classList.remove('h'),s.classList.add('h'),this.innerHTML='<i>▲</i> 收起详细设定'):(c.classList.add('h'),s.classList.remove('h'),this.innerHTML='<i>▼</i> 人物详细设定')});const m=document.getElementById('xm'),g=document.getElementById('o'),u=document.getElementById('xmb'),p=document.getElementById('cxm'),h=document.getElementById('cx');u.addEventListener('click',function(){m.classList.remove('h'),g.classList.remove('h')}),p.addEventListener('click',function(){m.classList.add('h'),g.classList.add('h')}),g.addEventListener('click',function(){m.classList.add('h'),this.classList.add('h')}),document.querySelectorAll('.xi').forEach(function(e){e.addEventListener('click',function(){const e=this.getAttribute('data-value');h.value?h.value+=', '+e:h.value=e})});const v=document.getElementById('bc2'),y=document.getElementById('abb');let b=0,w=15;y.addEventListener('click',function(){if(b>=w)return;const e=document.createElement('div');e.className='ri',e.innerHTML='<input type="text" class="f1" placeholder="请输入行为模式..."><button class="b bsm bd dbb">-</button>',v.appendChild(e),b++,b>=w&&(y.disabled=!0)}),v.addEventListener('click',function(e){e.target.classList.contains('dbb')&&(e.target.closest('.ri').remove(),b--,y.disabled=!1)});const S=document.getElementById('sb'),T=document.getElementById('toast');S.addEventListener('click',function(){let e="";e+="# 世界背景\n";const t=document.getElementById('w'),i=t.options[t.selectedIndex].text;"custom"===t.value?e+=document.getElementById('cw').value+"\n":e+=i+"\n";e+="\n# 世界规则\n";const n=document.querySelectorAll('.ri input');n.forEach((t,i)=>{t.value.trim()&&(e+=`${i+1}. ${t.value}\n`)});n.length||(e+="无特殊规则\n");e+="\n# 系统注册\n";const r=document.getElementById('sa');r.value.trim()?e+=r.value+"\n":e+="无系统能力\n";e+="\n# 主要角色\n";const o=document.getElementById('cn'),d=document.getElementById('cg'),a=document.getElementById('ca'),l=document.getElementById('cb');e+=`姓名：${o.value||"未命名"}\n性别：${d.value||"未指定"}\n年龄：${a.value||"18"}\n身材：${l.value||"未描述"}\n`;if(c.classList.contains('h')){const t=document.getElementById('cs');t.value.trim()&&(e+=`描述：${t.value}\n`)}else{e+="\n## 详细设定\n";const t=document.getElementById('cc'),i=document.getElementById('cbg'),n=document.getElementById('ce'),r=document.getElementById('ci'),o=document.getElementById('cx'),d=document.getElementById('ca');t.value.trim()&&(e+=`穿着：${t.value}\n`),i.value.trim()&&(e+=`背景：${i.value}\n`),n.value.trim()&&(e+=`外在人设：${n.value}\n`),r.value.trim()&&(e+=`内在人设：${r.value}\n`),o.value.trim()&&(e+=`XP：${o.value}\n`);const a=document.querySelectorAll('#bc2 input');a.length&&(e+="行为模式：\n",a.forEach(t=>{t.value.trim()&&(e+=`- ${t.value}\n`)}),d.value.trim()&&(e+=`能力：${d.value}\n`)}e+="\n# 其他设定\n";const s=document.getElementById('np'),m=s.options[s.selectedIndex].text;e+=`人称：${m}\n`;const C=document.getElementById('chatMsgTextarea');if(C){C.value=e,T.classList.add('show'),setTimeout(()=>{T.classList.remove('show')},3000)}else alert("平台输入框未找到！设定内容已复制到剪贴板。\n\n"+e),navigator.clipboard.writeText(e)})